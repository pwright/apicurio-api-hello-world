title: Apicurio Registry Hello World
subtitle: A minimal registry
overview: |
  In this example, we'll run Apicurio Registry and populate it with a few 
  schemas using the API.
  Then, we use the API to query the 
prerequisites: |
  Access to a Kubernetes cluster. If you don't have access, skip the setup
  steps and use Docker to set up Apicurio Registry as described in 
  ([Using Docker][getting-started])
  [getting-started]: https://www.apicur.io/registry/docs/apicurio-registry/2.6.x/getting-started/assembly-installing-registry-docker.html
  
sites:
  apicurio:
    title: Registry
    platform: kubernetes
    namespace: apicurio
    env:
      KUBECONFIG: ~/.kube/config-apicurio
steps:
  - standard: kubernetes/set_up_your_clusters
  - title: Deploy Apicurio Registry
    preamble: |
      The `apicurio-deployment.yaml` file defines a Kubernetes deployment
      for Apicurio registry and exposes the console and API through 8080.
    commands:
      apicurio:
        - run: "kubectl apply -f apicurio-deployment.yaml"

  - title: Expose the Registry
    preamble: |
      To make the console and API available to external traffic
      you need to port forward 8080.

    commands:
      apicurio:
        - await_resource: deployment/apicurio-registry
        - run: kubectl port-forward deployment/apicurio-registry 8080:8080
          apply: readme
        - run: kubectl port-forward deployment/apicurio-registry 8080:8080 > /dev/null &
          apply: test
  - title: Populate the Registry

    preamble: |
      The `data1.json` file defines an AVRO schema.
      You can define a group `my-group` as you submit it to the API.

    commands:
      apicurio:
        - run: sleep 5
          apply: test
        - run: 'curl -X POST -H "Content-type: application/json; artifactType=AVRO" -H "X-Registry-ArtifactId: share-price" --data @data1.json http://localhost:8080/apis/registry/v2/groups/my-group/artifacts'
          output: |
            {"contentId":1,"createdBy":"","createdOn":"2024-10-10T14:15:05+0000",
            "globalId":1,"groupId":"my-group","id":"share-price","modifiedBy":"",
            "modifiedOn":"2024-10-10T14:15:05+0000","name":"price","references":[],
            "state":"ENABLED","type":"AVRO","version":"1"}

  - title: Query the Registry
    preamble: |
      You can search on an artifact name using a GET query,
      however the results might not contain the metadata you require.

    commands:
      apicurio:
        - run: 'curl -X GET "http://localhost:8080/apis/registry/v2/search/artifacts?name=share-price"   -H "Accept: application/json"'
          output: |
            {"artifacts":[{"createdBy":"","createdOn":"2024-10-10T14:15:05+0000",
            "groupId":"my-group","id":"share-price","modifiedBy":"",
            "modifiedOn":"2024-10-10T14:15:05+0000","name":"price","state":"ENABLED",
            "type":"AVRO"}],"count":1}